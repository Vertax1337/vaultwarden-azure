{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "storageAccountSKU": {
      "type": "string",
      "defaultValue": "Standard_LRS",
      "allowedValues": [
        "Standard_LRS",
        "Standard_ZRS",
        "Standard_GRS",
        "Standard_RAGRS",
        "Standard_GZRS",
        "Standard_RAGZRS"
      ]
    },
    "AdminAPIKEY": {
      "type": "securestring",
      "defaultValue": "[base64(newGuid())]",
      "minLength": 20
    },
    "cpuCore": {
      "type": "string",
      "defaultValue": "0.25",
      "allowedValues": [
        "0.25",
        "0.5",
        "0.75",
        "1",
        "1.25",
        "1.5",
        "1.75",
        "2"
      ]
    },
    "memorySize": {
      "type": "string",
      "defaultValue": "0.5",
      "allowedValues": [
        "0.5",
        "1",
        "1.5",
        "2",
        "3",
        "3.5",
        "4"
      ]
    },
    "allowInsecureHttp": {
      "type": "bool",
      "defaultValue": true
    },
    "domain": {
      "type": "string"
    },
    "smtpHost": {
      "type": "string",
      "defaultValue": "smtp.office365.com"
    },
    "smtpPort": {
      "type": "string",
      "defaultValue": "587"
    },
    "smtpSecurity": {
      "type": "string",
      "defaultValue": "starttls",
      "allowedValues": [
        "starttls",
        "force_tls",
        "off"
      ]
    },
    "smtpFrom": {
      "type": "string"
    },
    "smtpUsername": {
      "type": "string"
    },
    "smtpPassword": {
      "type": "securestring"
    },
    "signupsAllowed": {
      "type": "bool",
      "defaultValue": false
    },
    "signupsVerify": {
      "type": "bool",
      "defaultValue": true
    },
    "signupsDomainsWhitelist": {
      "type": "string",
      "defaultValue": ""
    },
    "showPremium": {
      "type": "bool",
      "defaultValue": true
    },
    "allowAzureServicesToPostgres": {
      "type": "bool",
      "defaultValue": true
    },
    "postgresFirewallStartIp": {
      "type": "string",
      "defaultValue": ""
    },
    "postgresFirewallEndIp": {
      "type": "string",
      "defaultValue": ""
    },
    "dbPassword": {
      "type": "securestring"
    }
  },
  "variables": {
    "location": "[resourceGroup().location]",
    "logWorkspaceName": "[concat('vw-logwks', uniqueString(resourceGroup().id))]",
    "storageAccountName": "[concat('vwstorage', uniqueString(resourceGroup().id))]",
    "envName": "[concat('appenv-vaultwarden', uniqueString(resourceGroup().id))]",
    "pgServerName": "[concat('vwdbi-', uniqueString(resourceGroup().id))]",
    "pgDbName": "vaultwarden",
    "databaseUrl": "[format('postgresql://vwadmin:{0}@{1}:5432/{2}?sslmode=require', parameters('dbPassword'), reference(resourceId('Microsoft.DBforPostgreSQL/flexibleServers', variables('pgServerName')), '2025-08-01').fullyQualifiedDomainName, variables('pgDbName'))]"
  },
  "resources": [],
  "outputs": {}
}
